(()=>{var e={};e.id=434,e.ids=[434],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3606:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>j,routeModule:()=>h,serverHooks:()=>b,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>x,POST:()=>S});var n=r(6559),a=r(8088),o=r(7719),i=r(2190),l=r(4999),c=r(3873),u=r.n(c),p=r(9748),d=r.n(p),g=r(4366);let m=u().join(process.cwd(),"src","app","api","temp","db.json");async function f(){try{let e=await d().readFile(m,"utf-8");return JSON.parse(e)}catch(e){if("ENOENT"===e.code){await d().mkdir(u().dirname(m),{recursive:!0});let e={users:[],messages:[]};return await d().writeFile(m,JSON.stringify(e,null,2)),e}throw e}}async function w(e){await d().writeFile(m,JSON.stringify(e,null,2))}async function x(e){try{let e=(await f()).messages.map(e=>{let{url:t,...r}=e;return r});return i.NextResponse.json(e)}catch(e){return console.error("GET messages error:",e),i.NextResponse.json({message:"Internal Server Error"},{status:500})}}async function S(e){try{let t=await e.json(),r=await f(),s=(0,l.b3)(),n=Date.now().toString(),a="file"===t.type?`${new URL(e.url).origin}/shared/${n}`:void 0,o=(s.get("x-forwarded-for")??"127.0.0.1").split(",")[0].trim(),c={id:n,uploadedAt:new Date().toISOString(),shareableUrl:a,seenBy:[],deviceInfo:{userAgent:s.get("user-agent")||"Unknown",ip:o.startsWith("::ffff:")?o.substring(7):o},...t};r.messages.push(c),await w(r);let{url:u,...p}=c;return(0,g.broadcastMessage)({action:"add",message:p}),i.NextResponse.json(p,{status:201})}catch(e){return console.error("POST message error:",e),i.NextResponse.json({message:"Internal Server Error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/messages/route",pathname:"/api/messages",filename:"route",bundlePath:"app/api/messages/route"},resolvedPagePath:"/home/user/self-transfer/src/app/api/messages/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:y,serverHooks:b}=h;function j(){return(0,o.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:y})}},3873:e=>{"use strict";e.exports=require("path")},4366:(e,t,r)=>{"use strict";async function s(e){return new Response(new ReadableStream({start(t){let r=e=>{try{t.enqueue(`data: ${e}

`)}catch(e){console.error("SSE Error:",e)}};global.clients.add(r),console.log("SSE client connected. Total clients:",global.clients.size),e.signal.addEventListener("abort",()=>{global.clients.delete(r),t.close(),console.log("SSE client disconnected. Total clients:",global.clients.size)})}}),{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}function n(e){let t=JSON.stringify(e);for(let e of(console.log(`Broadcasting message to ${global.clients.size} clients.`),global.clients))e(t)}r.r(t),r.d(t,{GET:()=>s,broadcastMessage:()=>n}),global.clients||(global.clients=new Set)},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9748:e=>{"use strict";e.exports=require("fs/promises")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580,999],()=>r(3606));module.exports=s})();