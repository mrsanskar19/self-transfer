(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{283:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>i,c:()=>n});var a=s(5155),r=s(2115),l=s(5695);let n=(0,r.createContext)({user:null,deviceInfo:null,loading:!0,login:async()=>{},signup:async()=>{},logout:()=>{}}),i=e=>{let{children:t}=e,[s,i]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),m=(0,l.useRouter)();(0,r.useEffect)(()=>{try{let e=sessionStorage.getItem("ephemeral-user"),t=sessionStorage.getItem("ephemeral-device");e&&i(JSON.parse(e)),t&&o(JSON.parse(t))}catch(e){console.error("Failed to parse from session storage",e)}u(!1)},[]);let f=(0,r.useCallback)(async(e,t)=>{let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(s.ok){let t=await s.json(),a={username:e},r={ip:t.ip,userAgent:t.userAgent};sessionStorage.setItem("ephemeral-user",JSON.stringify(a)),sessionStorage.setItem("ephemeral-device",JSON.stringify(r)),i(a),o(r)}else throw Error((await s.json()).message||"Login failed")},[]),p=(0,r.useCallback)(async(e,t)=>{let s=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(s.ok)await f(e,t);else throw Error((await s.json()).message||"Signup failed")},[f]),x=(0,r.useCallback)(()=>{sessionStorage.removeItem("ephemeral-user"),sessionStorage.removeItem("ephemeral-device"),i(null),o(null),m.push("/")},[m]);return(0,a.jsx)(n.Provider,{value:{user:s,deviceInfo:d,loading:c,login:f,signup:p,logout:x},children:t})}},285:(e,t,s)=>{"use strict";s.d(t,{$:()=>o});var a=s(5155),r=s(2115),l=s(4253),n=s(2085),i=s(9434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:o=!1,...c}=e,u=o?l.DX:"button";return(0,a.jsx)(u,{className:(0,i.cn)(d({variant:r,size:n,className:s})),ref:t,...c})});o.displayName="Button"},2523:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(5155),r=s(2115),l=s(9434);let n=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},4944:(e,t,s)=>{"use strict";s.d(t,{Progress:()=>i});var a=s(5155),r=s(2115),l=s(5863),n=s(9434);let i=r.forwardRef((e,t)=>{let{className:s,value:r,...i}=e;return(0,a.jsx)(l.bL,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,a.jsx)(l.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});i.displayName=l.bL.displayName},5365:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>d,TN:()=>c,XL:()=>o});var a=s(5155),r=s(2115),l=s(2085),n=s(9434);let i=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,...l}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(i({variant:r}),s),...l})});d.displayName="Alert";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})});o.displayName="AlertTitle";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",s),...r})});c.displayName="AlertDescription"},5986:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>em});var a=s(5155),r=s(2115),l=s(5695),n=s(6681),i=s(5365),d=s(172),o=s(1133),c=s(7481),u=s(285),m=s(2523),f=s(5066),p=s(3672),x=s(4944);function h(e){let{currentUser:t}=e,[s,l]=(0,r.useState)(""),[n,i]=(0,r.useState)(null),[o,h]=(0,r.useState)(!1),g=(0,r.useRef)(null),{toast:v}=(0,c.dj)(),j=e=>new Promise((t,s)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>s(e)}),N=async()=>{let e;if((n||s.trim())&&t){h(!0);try{if(n){let s=await j(n);e={type:"file",content:n.name,name:n.name,url:s,userId:t.username}}else e={type:"text",content:s,userId:t.username};if(!(await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to send message")}catch(e){v({title:"Error",description:"Could not send message.",variant:"destructive"})}finally{h(!1),i(null),l(""),g.current&&(g.current.value="")}}};return(0,a.jsxs)("footer",{className:"p-4 border-t bg-background",children:[o&&n&&(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)(x.Progress,{value:50*!!o,className:"w-full h-1"}),(0,a.jsxs)("p",{className:"text-xs text-center text-muted-foreground mt-1",children:["Uploading ",n.name,"..."]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.p,{type:"text",placeholder:n?n.name:"Send a message or select a file...",value:s,onChange:e=>{n||l(e.target.value)},onKeyDown:e=>"Enter"===e.key&&!o&&N(),className:"pr-24 pl-10",disabled:o}),(0,a.jsx)(m.p,{type:"file",ref:g,onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];i(t),l(t.name)}},className:"hidden"}),(0,a.jsx)("div",{className:"absolute top-1/2 left-2 -translate-y-1/2",children:(0,a.jsx)(u.$,{variant:"ghost",size:"icon",onClick:()=>{var e;null==(e=g.current)||e.click()},disabled:o,className:"h-8 w-8",children:(0,a.jsx)(f.A,{className:"h-5 w-5 text-muted-foreground"})})}),(0,a.jsx)("div",{className:"absolute top-1/2 right-2 -translate-y-1/2 flex items-center",children:(0,a.jsx)(u.$,{onClick:N,disabled:!n&&!s.trim()||o,size:"icon",className:"h-8 w-8",children:o&&!n?(0,a.jsx)(d.A,{className:"animate-spin"}):(0,a.jsx)(p.A,{className:"h-5 w-5"})})})]})]})}var g=s(6766),v=s(5977),j=s(9434);let N=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.bL,{ref:t,className:(0,j.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});N.displayName=v.bL.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v._V,{ref:t,className:(0,j.cn)("aspect-square h-full w-full",s),...r})}).displayName=v._V.displayName;let y=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(v.H4,{ref:t,className:(0,j.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});y.displayName=v.H4.displayName;var b=s(2448),w=s(8718),A=s(6955),S=s(518),k=s(8350),E=s(7223),T=s(5943),C=s(7300),R=s(5731),I=s(5599),z=s(3125),O=s(6695),_=s(1734),D=s(3158),L=s(154);let U=_.bL,P=_.l9;_.YJ,_.ZL,_.Pb,_.z6,r.forwardRef((e,t)=>{let{className:s,inset:r,children:l,...n}=e;return(0,a.jsxs)(_.ZP,{ref:t,className:(0,j.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...n,children:[l,(0,a.jsx)(D.A,{className:"ml-auto"})]})}).displayName=_.ZP.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_.G5,{ref:t,className:(0,j.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=_.G5.displayName;let F=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(_.ZL,{children:(0,a.jsx)(_.UC,{ref:t,sideOffset:r,className:(0,j.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});F.displayName=_.UC.displayName;let V=r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(_.q7,{ref:t,className:(0,j.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...l})});V.displayName=_.q7.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:l,...n}=e;return(0,a.jsxs)(_.H_,{ref:t,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(_.VF,{children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})}),r]})}).displayName=_.H_.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(_.hN,{ref:t,className:(0,j.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(_.VF,{children:(0,a.jsx)(L.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=_.hN.displayName,r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(_.JU,{ref:t,className:(0,j.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...l})}).displayName=_.JU.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_.wv,{ref:t,className:(0,j.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=_.wv.displayName;let J=e=>{var t,s;return null!=(s=null==e||null==(t=e[0])?void 0:t.toUpperCase())?s:"U"};function M(e){var t,s,l;let{message:n,isOwnMessage:i}=e,[o,f]=(0,r.useState)(null),[p,x]=(0,r.useState)(null),[h,v]=(0,r.useState)(!1),{toast:j}=(0,c.dj)(),_="file"===n.type&&(null==(t=n.name)?void 0:t.match(/\.(jpeg|jpg|gif|png|webp)$/i));(0,r.useEffect)(()=>{(async()=>{if(_){v(!0);try{let e=await fetch("/api/messages/".concat(n.id));if(e.ok){let t=await e.json();t.url&&x(t.url)}}catch(e){}finally{v(!1)}}})()},[n.id,_]);let D=async e=>{f(e);try{if(!(await fetch("/api/messages/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete")}catch(e){j({title:"Error",description:"Could not delete message.",variant:"destructive"})}finally{f(null)}},L=async()=>{var e;let t=n.url;if(!t){let e=await fetch("/api/messages/".concat(n.id));if(!e.ok)return void j({title:"Error",description:"Could not retrieve file for download.",variant:"destructive"});t=(await e.json()).url}if(!t||!n.name)return;let s=document.createElement("a");s.href=t,s.setAttribute("download",n.name),document.body.appendChild(s),s.click(),null==(e=s.parentNode)||e.removeChild(s),await fetch("/api/messages/".concat(n.id),{method:"DELETE"})},M=e=>{navigator.clipboard.writeText(e).then(()=>{j({title:"Copied!",description:"Shareable link copied to clipboard."})})},$=e=>{let t="sms:?&body=".concat(encodeURIComponent("Here is the file you requested: ".concat(e)));window.location.href=t},B=e=>{let{message:t,onDownload:s,isImage:r,imageUrl:l,isLoadingUrl:n}=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[r&&(l||n)&&(0,a.jsxs)("div",{className:"relative w-full aspect-video rounded-lg overflow-hidden bg-muted/50",children:[n&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(d.A,{className:"animate-spin text-primary"})}),l&&(0,a.jsx)(g.default,{src:l,alt:t.name||"Image preview",fill:!0,objectFit:"contain"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-primary/10 dark:bg-primary/20 p-3 rounded-lg",children:[(0,a.jsx)(b.A,{className:"h-6 w-6 flex-shrink-0 text-primary-foreground/80"}),(0,a.jsx)("p",{className:"font-medium truncate flex-1",title:t.name,children:t.name}),(0,a.jsx)(u.$,{onClick:s,variant:"ghost",size:"icon",className:"h-7 w-7 text-primary-foreground/80 hover:text-primary-foreground",children:(0,a.jsx)(w.A,{size:16})})]})]})},Z=n.seenBy&&n.seenBy.length>0&&n.seenBy.some(e=>{var t;return e!==(null==(t=n.deviceInfo)?void 0:t.ip)}),H=null==(l=n.deviceInfo)||null==(s=l.ip)?void 0:s.replace("::ffff:",""),q=new Date(n.uploadedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),X="flex w-full max-w-lg gap-3 mx-auto ".concat(i?"justify-end":"justify-start");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:X,children:[!i&&(0,a.jsx)(N,{className:"h-8 w-8",children:(0,a.jsx)(y,{children:J(n.userId)})}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 w-full ".concat(i?"items-end":"items-start"),children:[(0,a.jsx)("div",{className:"p-3 rounded-2xl w-fit max-w-xs lg:max-w-sm ".concat(i?"rounded-br-none bg-primary text-primary-foreground":"rounded-bl-none bg-background dark:bg-muted"),children:_?(0,a.jsx)(B,{message:n,onDownload:L,isImage:!0,imageUrl:p,isLoadingUrl:h}):"file"===n.type?(0,a.jsx)(B,{message:n,onDownload:L,isImage:!1,imageUrl:null,isLoadingUrl:!1}):(0,a.jsx)("p",{className:"text-sm",children:n.content})}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted-foreground px-2",children:[(0,a.jsxs)("span",{children:[H," (",n.userId,")"]}),(0,a.jsx)("span",{children:q}),i&&(Z?(0,a.jsx)(A.A,{size:14,className:"text-blue-500"}):(0,a.jsx)(S.A,{size:14}))]})]}),(0,a.jsxs)(U,{children:[(0,a.jsx)(P,{asChild:!0,children:(0,a.jsx)(u.$,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",children:(0,a.jsx)(k.A,{size:16})})}),(0,a.jsxs)(F,{align:i?"end":"start",children:[i&&(0,a.jsxs)(V,{onClick:()=>D(n.id),children:[o===n.id?(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),"Delete"]}),(0,a.jsxs)(V,{disabled:!0,children:[(0,a.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"Edit"]}),(0,a.jsxs)(V,{disabled:!0,children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Report"]})]})]}),i&&(0,a.jsx)(N,{className:"h-8 w-8",children:(0,a.jsx)(y,{children:J(n.userId)})})]}),i&&"file"===n.type&&n.shareableUrl&&(0,a.jsx)("div",{className:"flex justify-end items-end gap-3 mb-4",children:(0,a.jsx)("div",{className:"max-w-xs lg:max-w-md space-y-2 ml-auto",children:(0,a.jsx)(O.Zp,{className:"bg-background dark:bg-muted",children:(0,a.jsxs)(O.Wu,{className:"p-3 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold text-sm mb-1 flex items-center gap-2",children:[(0,a.jsx)(R.A,{size:14})," Shareable Link"]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Expires: ",new Date(new Date(n.uploadedAt).getTime()+36e5).toLocaleTimeString()]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(m.p,{id:"share-link-".concat(n.id),type:"text",readOnly:!0,value:n.shareableUrl,className:"bg-background h-9 text-xs"}),(0,a.jsx)(u.$,{variant:"outline",size:"icon",onClick:()=>M(n.shareableUrl),title:"Copy Link",className:"h-9 w-9",children:(0,a.jsx)(I.A,{className:"h-4 w-4"})}),(0,a.jsx)(u.$,{variant:"outline",size:"icon",onClick:()=>$(n.shareableUrl),title:"Share via Text",className:"h-9 w-9",children:(0,a.jsx)(z.A,{className:"h-4 w-4"})})]})]})})})})]})}function $(e){let{messages:t,currentUser:s,currentDeviceIp:l}=e,n=(0,r.useRef)(null),i=()=>{var e;null==(e=n.current)||e.scrollIntoView({behavior:"smooth"})};if((0,r.useEffect)(()=>{i()},[t]),!s)return null;let d=t.sort((e,t)=>new Date(e.uploadedAt).getTime()-new Date(t.uploadedAt).getTime());return(0,a.jsxs)("div",{className:"space-y-4",children:[d.map(e=>{var t;return(0,a.jsx)(M,{message:e,isOwnMessage:(null==(t=e.deviceInfo)?void 0:t.ip)===l},e.id)}),(0,a.jsx)("div",{ref:n})]})}var B=s(5821),Z=s(2085),H=s(5318);let q=B.bL,X=B.l9;B.bm;let Y=B.ZL,G=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(B.hJ,{className:(0,j.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});G.displayName=B.hJ.displayName;let W=(0,Z.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),K=r.forwardRef((e,t)=>{let{side:s="right",className:r,children:l,...n}=e;return(0,a.jsxs)(Y,{children:[(0,a.jsx)(G,{}),(0,a.jsxs)(B.UC,{ref:t,className:(0,j.cn)(W({side:s}),r),...n,children:[l,(0,a.jsxs)(B.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(H.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});K.displayName=B.UC.displayName;let Q=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,j.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};Q.displayName="SheetHeader";let ee=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(B.hE,{ref:t,className:(0,j.cn)("text-lg font-semibold text-foreground",s),...r})});ee.displayName=B.hE.displayName;let et=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(B.VY,{ref:t,className:(0,j.cn)("text-sm text-muted-foreground",s),...r})});et.displayName=B.VY.displayName;var es=s(8271),ea=s(3349),er=s(5120),el=s(7489);let en=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:l=!0,...n}=e;return(0,a.jsx)(el.b,{ref:t,decorative:l,orientation:r,className:(0,j.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...n})});en.displayName=el.b.displayName;var ei=s(9051);let ed=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(ei.bL,{ref:t,className:(0,j.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(ei.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(eo,{}),(0,a.jsx)(ei.OK,{})]})});ed.displayName=ei.bL.displayName;let eo=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...l}=e;return(0,a.jsx)(ei.VM,{ref:t,orientation:r,className:(0,j.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(ei.lr,{className:"relative flex-1 rounded-full bg-border"})})});function ec(e){let{messages:t}=e,s=(()=>{let e=new Map;return t.forEach(t=>{if(t.deviceInfo){let s="".concat(t.deviceInfo.ip,"-").concat(t.deviceInfo.userAgent);e.has(s)||e.set(s,t.deviceInfo)}}),Array.from(e.values())})();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Q,{children:[(0,a.jsx)(ee,{children:"Settings"}),(0,a.jsx)(et,{children:"Manage your Ephemeral Vault preferences and view active devices."})]}),(0,a.jsx)(en,{className:"my-4"}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Active Devices"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"List of unique devices that have sent messages in this session."}),(0,a.jsx)(ed,{className:"h-64 border rounded-md",children:(0,a.jsx)("div",{className:"p-4 space-y-4",children:s.length>0?s.map((e,t)=>(0,a.jsx)("div",{className:"p-3 bg-muted/50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(er.A,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("p",{className:"font-semibold truncate text-sm",children:["IP: ",e.ip.replace("::ffff:","")]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.userAgent})]})]})},t)):(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"No active devices detected yet."})})})]})]})}function eu(e){let{user:t,onLogout:s,deviceInfo:r,messages:l}=e;return(0,a.jsxs)("header",{className:"p-4 border-b bg-background",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Ephemeral Vault"}),t&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Welcome, ",t.username]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(q,{children:[(0,a.jsx)(X,{asChild:!0,children:(0,a.jsx)(u.$,{variant:"outline",size:"icon",children:(0,a.jsx)(es.A,{className:"h-5 w-5"})})}),(0,a.jsx)(K,{children:(0,a.jsx)(ec,{messages:l})})]}),(0,a.jsx)(u.$,{variant:"outline",size:"icon",onClick:s,children:(0,a.jsx)(ea.A,{className:"h-5 w-5 text-destructive"})})]})]}),r&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground flex items-center gap-2 border-t pt-2",children:[(0,a.jsx)(er.A,{size:14}),(0,a.jsxs)("p",{className:"truncate",children:[(0,a.jsx)("strong",{children:"Your IP:"})," ",r.ip.replace("::ffff:","")]})]})]})}function em(){let{user:e,deviceInfo:t,loading:s,logout:u}=(0,n.A)(),m=(0,l.useRouter)(),{toast:f}=(0,c.dj)(),[p,x]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{s||e||m.push("/login")},[e,s,m]),(0,r.useEffect)(()=>{e&&(async()=>{v(!0);try{let e=await fetch("/api/messages");if(e.ok){let t=await e.json();x(t)}else f({title:"Error",description:"Failed to load messages.",variant:"destructive"})}catch(e){console.error("Failed to fetch initial data:",e),f({title:"Error",description:"An error occurred while fetching data.",variant:"destructive"})}finally{v(!1)}})()},[e,f]),(0,r.useEffect)(()=>{if(!e)return;let s=new EventSource("/api/messages/events");return s.onmessage=e=>{try{let s=JSON.parse(e.data);x(e=>{if("delete"===s.action)return e.filter(e=>e.id!==s.id);if("add"===s.action){var a;let r=s.message;return e.some(e=>e.id===r.id)?e:((null==t?void 0:t.ip)&&(null==(a=r.deviceInfo)?void 0:a.ip)!==t.ip&&fetch("/api/messages/".concat(r.id,"/seen"),{method:"POST"}),[...e,r].sort((e,t)=>new Date(e.uploadedAt).getTime()-new Date(t.uploadedAt).getTime()))}return"seen"===s.action?e.map(e=>e.id===s.id&&e.seenBy&&!e.seenBy.includes(s.ip)?{...e,seenBy:[...e.seenBy,s.ip]}:e):e})}catch(e){}},s.onerror=e=>{},()=>{s.close()}},[e,null==t?void 0:t.ip]),s||!t)?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,a.jsx)(d.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,a.jsxs)("div",{className:"flex h-[calc(100vh-3.5rem)] flex-col bg-muted/20 dark:bg-card",children:[(0,a.jsx)(eu,{user:e,onLogout:u,deviceInfo:t,messages:p}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-6",children:g?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)(d.A,{className:"h-12 w-12 animate-spin text-primary"})}):p.length>0?(0,a.jsx)($,{messages:p,currentUser:e,currentDeviceIp:t.ip}):(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsxs)(i.Fc,{className:"max-w-md text-center bg-background",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 mx-auto mb-2"}),(0,a.jsx)(i.XL,{children:"Vault is Empty"}),(0,a.jsx)(i.TN,{children:"Use the input below to send a message or upload a file."})]})})}),(0,a.jsx)(h,{currentUser:e})]})}eo.displayName=ei.VM.displayName},6681:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(2115),r=s(283);let l=()=>{let e=(0,a.useContext)(r.c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i});var a=s(5155),r=s(2115),l=s(9434);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});n.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},7016:(e,t,s)=>{Promise.resolve().then(s.bind(s,5986))},7481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m});var a=s(2115);let r=0,l=new Map,n=e=>{if(l.has(e))return;let t=setTimeout(()=>{l.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);l.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?n(s):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],o={toasts:[]};function c(e){o=i(o,e),d.forEach(e=>{e(o)})}function u(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:s});return c({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(o);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},9434:(e,t,s)=>{"use strict";s.d(t,{cn:()=>l});var a=s(2596),r=s(9688);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[277,63,11,530,441,684,358],()=>t(7016)),_N_E=e.O()}]);